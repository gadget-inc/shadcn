import { z as z$1 } from 'zod';
import h from 'path';
import { red, yellow, cyan, green } from 'kleur/colors';
import { promises } from 'fs';
import { tmpdir } from 'os';
import Y from 'ora';
import x from 'deepmerge';
import Z from 'stringify-object';
import { SyntaxKind, Project, ScriptKind, QuoteKind } from 'ts-morph';
import { HttpsProxyAgent } from 'https-proxy-agent';
import ae from 'node-fetch';

var P=z$1.enum(["registry:lib","registry:block","registry:component","registry:ui","registry:hook","registry:page","registry:file","registry:theme","registry:example","registry:style","registry:internal"]),D=z$1.discriminatedUnion("type",[z$1.object({path:z$1.string(),content:z$1.string().optional(),type:z$1.enum(["registry:file","registry:page"]),target:z$1.string()}),z$1.object({path:z$1.string(),content:z$1.string().optional(),type:P.exclude(["registry:file","registry:page"]),target:z$1.string().optional()})]),U=z$1.object({config:z$1.object({content:z$1.array(z$1.string()).optional(),theme:z$1.record(z$1.string(),z$1.any()).optional(),plugins:z$1.array(z$1.string()).optional()}).optional()}),M=z$1.object({light:z$1.record(z$1.string(),z$1.string()).optional(),dark:z$1.record(z$1.string(),z$1.string()).optional()}),y=z$1.object({$schema:z$1.string().optional(),name:z$1.string(),type:P,title:z$1.string().optional(),author:z$1.string().min(2).optional(),description:z$1.string().optional(),dependencies:z$1.array(z$1.string()).optional(),devDependencies:z$1.array(z$1.string()).optional(),registryDependencies:z$1.array(z$1.string()).optional(),files:z$1.array(D).optional(),tailwind:U.optional(),cssVars:M.optional(),meta:z$1.record(z$1.string(),z$1.any()).optional(),docs:z$1.string().optional(),categories:z$1.array(z$1.string()).optional()}),xe=z$1.object({name:z$1.string(),homepage:z$1.string(),items:z$1.array(y)}),E=z$1.array(y),v=z$1.array(z$1.object({name:z$1.string(),label:z$1.string()})),K=z$1.record(z$1.string(),z$1.record(z$1.string(),z$1.string())),I=z$1.object({inlineColors:z$1.object({light:z$1.record(z$1.string(),z$1.string()),dark:z$1.record(z$1.string(),z$1.string())}),cssVars:z$1.object({light:z$1.record(z$1.string(),z$1.string()),dark:z$1.record(z$1.string(),z$1.string())}),inlineColorsTemplate:z$1.string(),cssVarsTemplate:z$1.string()}),A=y.pick({dependencies:!0,devDependencies:!0,files:!0,tailwind:!0,cssVars:!0,docs:!0});var m={error:red,warn:yellow,info:cyan,success:green};var p={error(...e){console.log(m.error(e.join(" ")));},warn(...e){console.log(m.warn(e.join(" ")));},info(...e){console.log(m.info(e.join(" ")));},success(...e){console.log(m.success(e.join(" ")));},log(...e){console.log(e.join(" "));},break(){console.log("");}};function d(e){if(p.error("Something went wrong. Please check the error below for more details."),p.error("If the problem persists, please open an issue on GitHub."),p.error(""),typeof e=="string"&&(p.error(e),p.break(),process.exit(1)),e instanceof z$1.ZodError){p.error("Validation failed:");for(let[t,r]of Object.entries(e.flatten().fieldErrors))p.error(`- ${m.info(t)}: ${r}`);p.break(),process.exit(1);}e instanceof Error&&(p.error(e.message),p.break(),process.exit(1)),p.break(),process.exit(1);}function $(e,t){return Y({text:e,isSilent:t?.silent})}async function Ne(e,t,r){if(!e||(r={silent:!1,tailwindVersion:"v3",...r},r.tailwindVersion==="v4"))return;let n=h.relative(t.resolvedPaths.cwd,t.resolvedPaths.tailwindConfig),s=$(`Updating ${m.info(n)}`,{silent:r.silent}).start(),o=await promises.readFile(t.resolvedPaths.tailwindConfig,"utf8"),l=await X(o,e,t);await promises.writeFile(t.resolvedPaths.tailwindConfig,l,"utf8"),s?.succeed();}async function X(e,t,r){let n=await z(e,r),s=n.getDescendantsOfKind(SyntaxKind.ObjectLiteralExpression).find(l=>l.getProperties().some(g=>g.isKind(SyntaxKind.PropertyAssignment)&&g.getName()==="content"));if(!s)return e;let o=ne(s);return ee(s,{name:"darkMode",value:"class"},{quoteChar:o}),t.plugins?.forEach(l=>{te(s,l);}),t.theme&&await re(s,t.theme),n.getFullText()}function ee(e,t,{quoteChar:r}){let n=e.getProperty("darkMode");if(!n){let s={name:t.name,initializer:`[${r}${t.value}${r}]`};return t.name==="darkMode"?(e.insertPropertyAssignment(0,s),e):(e.addPropertyAssignment(s),e)}if(n.isKind(SyntaxKind.PropertyAssignment)){let s=n.getInitializer(),o=`${r}${t.value}${r}`;if(s?.isKind(SyntaxKind.StringLiteral)){let l=s.getText();return s.replaceWithText(`[${l}, ${o}]`),e}if(s?.isKind(SyntaxKind.ArrayLiteralExpression)){if(s.getElements().map(l=>l.getText()).includes(o))return e;s.addElement(o);}return e}return e}async function re(e,t){e.getProperty("theme")||e.addPropertyAssignment({name:"theme",initializer:"{}"}),S(e);let n=(e.getPropertyOrThrow("theme")?.asKindOrThrow(SyntaxKind.PropertyAssignment)).getInitializer();if(n?.isKind(SyntaxKind.ObjectLiteralExpression)){let s=n.getText(),o=await ie(s),l=x(o,t,{arrayMerge:(u,c)=>c}),g=Z(l).replace(/\'\.\.\.(.*)\'/g,"...$1").replace(/\'\"/g,"'").replace(/\"\'/g,"'").replace(/\'\[/g,"[").replace(/\]\'/g,"]").replace(/\'\\\'/g,"'").replace(/\\\'/g,"'").replace(/\\\'\'/g,"'").replace(/\'\'/g,"'");n.replaceWithText(g);}b(e);}function te(e,t){let r=e.getProperty("plugins");if(!r)return e.addPropertyAssignment({name:"plugins",initializer:`[${t}]`}),e;if(r.isKind(SyntaxKind.PropertyAssignment)){let n=r.getInitializer();if(n?.isKind(SyntaxKind.ArrayLiteralExpression)){if(n.getElements().map(s=>s.getText().replace(/["']/g,"")).includes(t.replace(/["']/g,"")))return e;n.addElement(t);}return e}return e}async function z(e,t){let r=await promises.mkdtemp(h.join(tmpdir(),"shadcn-")),n=t?.resolvedPaths?.tailwindConfig||"tailwind.config.ts",s=h.join(r,`shadcn-${h.basename(n)}`);return new Project({compilerOptions:{}}).createSourceFile(s,e,{scriptKind:h.extname(n)===".ts"?ScriptKind.TS:ScriptKind.JS})}function ne(e){return e.getFirstDescendantByKind(SyntaxKind.StringLiteral)?.getQuoteKind()===QuoteKind.Single?"'":'"'}function S(e){let t=e.getProperties();for(let r=0;r<t.length;r++){let n=t[r];if(n.isKind(SyntaxKind.SpreadAssignment)){let s=n.asKindOrThrow(SyntaxKind.SpreadAssignment),o=s.getExpression().getText();e.insertPropertyAssignment(r,{name:`"___${o.replace(/^\.\.\./,"")}"`,initializer:`"...${o.replace(/^\.\.\./,"")}"`}),s.remove();}else if(n.isKind(SyntaxKind.PropertyAssignment)){let o=n.asKindOrThrow(SyntaxKind.PropertyAssignment).getInitializer();o&&o.isKind(SyntaxKind.ObjectLiteralExpression)?S(o.asKindOrThrow(SyntaxKind.ObjectLiteralExpression)):o&&o.isKind(SyntaxKind.ArrayLiteralExpression)&&C(o.asKindOrThrow(SyntaxKind.ArrayLiteralExpression));}}}function C(e){let t=e.getElements();for(let r=0;r<t.length;r++){let n=t[r];if(n.isKind(SyntaxKind.ObjectLiteralExpression))S(n.asKindOrThrow(SyntaxKind.ObjectLiteralExpression));else if(n.isKind(SyntaxKind.ArrayLiteralExpression))C(n.asKindOrThrow(SyntaxKind.ArrayLiteralExpression));else if(n.isKind(SyntaxKind.SpreadElement)){let s=n.getText();e.removeElement(r),e.insertElement(r,`"${s}"`);}}}function b(e){let t=e.getProperties();for(let r=0;r<t.length;r++){let n=t[r];if(n.isKind(SyntaxKind.PropertyAssignment)){let s=n,o=s.getInitializer();if(o&&o.isKind(SyntaxKind.StringLiteral)){let l=o.asKindOrThrow(SyntaxKind.StringLiteral).getLiteralValue();l.startsWith("...")&&(e.insertSpreadAssignment(r,{expression:l.slice(3)}),s.remove());}else o?.isKind(SyntaxKind.ObjectLiteralExpression)?b(o):o&&o.isKind(SyntaxKind.ArrayLiteralExpression)&&O(o.asKindOrThrow(SyntaxKind.ArrayLiteralExpression));}}}function O(e){let t=e.getElements();for(let r=0;r<t.length;r++){let n=t[r];if(n.isKind(SyntaxKind.ObjectLiteralExpression))b(n.asKindOrThrow(SyntaxKind.ObjectLiteralExpression));else if(n.isKind(SyntaxKind.ArrayLiteralExpression))O(n.asKindOrThrow(SyntaxKind.ArrayLiteralExpression));else if(n.isKind(SyntaxKind.StringLiteral)){let s=n.getText(),o=/(?:^['"])(\.\.\..*)(?:['"]$)/g;o.test(s)&&(e.removeElement(r),e.insertElement(r,s.replace(o,"$1")));}}}async function ie(e){let r=(await z(`const theme = ${e}`,null)).getStatements()[0];if(r?.getKind()===SyntaxKind.VariableStatement){let s=(r.getDeclarationList()?.getDeclarations()[0]).getInitializer();if(s?.isKind(SyntaxKind.ObjectLiteralExpression))return await w(s)}throw new Error("Invalid input: not an object literal")}function w(e){let t={};for(let r of e.getProperties())if(r.isKind(SyntaxKind.PropertyAssignment)){let n=r.getName().replace(/\'/g,"");r.getInitializer()?.isKind(SyntaxKind.ObjectLiteralExpression)?t[n]=w(r.getInitializer()):r.getInitializer()?.isKind(SyntaxKind.ArrayLiteralExpression)?t[n]=R(r.getInitializer()):t[n]=L(r.getInitializer());}return t}function R(e){let t=[];for(let r of e.getElements())r.isKind(SyntaxKind.ObjectLiteralExpression)?t.push(w(r.asKindOrThrow(SyntaxKind.ObjectLiteralExpression))):r.isKind(SyntaxKind.ArrayLiteralExpression)?t.push(R(r.asKindOrThrow(SyntaxKind.ArrayLiteralExpression))):t.push(L(r));return t}function L(e){switch(e.getKind()){case SyntaxKind.StringLiteral:return e.getText();case SyntaxKind.NumericLiteral:return Number(e.getText());case SyntaxKind.TrueKeyword:return !0;case SyntaxKind.FalseKeyword:return !1;case SyntaxKind.NullKeyword:return null;case SyntaxKind.ArrayLiteralExpression:return e.getElements().map(L);case SyntaxKind.ObjectLiteralExpression:return w(e);default:return e.getText()}}function V(e){let t={};for(let r of Object.keys(e)){let n=r.split("-"),s=n[0],o=n.slice(1).join("-");o===""?typeof t[s]=="object"?t[s].DEFAULT=`hsl(var(--${r}))`:t[s]=`hsl(var(--${r}))`:(typeof t[s]!="object"&&(t[s]={DEFAULT:`hsl(var(--${s}))`}),t[s][o]=`hsl(var(--${r}))`);}for(let[r,n]of Object.entries(t))typeof n=="object"&&n.DEFAULT===`hsl(var(--${r}))`&&!(r in e)&&delete n.DEFAULT;return t}var ce=process.env.REGISTRY_URL??"https://ui.shadcn.com/r",pe=process.env.https_proxy?new HttpsProxyAgent(process.env.https_proxy):void 0;async function ge(){try{let[e]=await f(["index.json"]);return E.parse(e)}catch(e){p.error(`
`),d(e);}}async function rr(){try{let[e]=await f(["styles/index.json"]);return v.parse(e)}catch(e){return p.error(`
`),d(e),[]}}async function tr(){try{let[e]=await f(["icons/index.json"]);return K.parse(e)}catch(e){return d(e),{}}}async function nr(e,t){try{let[r]=await f([j(e)?e:`styles/${t}/${e}.json`]);return y.parse(r)}catch(r){return p.break(),d(r),null}}async function ir(){return [{name:"neutral",label:"Neutral"},{name:"gray",label:"Gray"},{name:"zinc",label:"Zinc"},{name:"stone",label:"Stone"},{name:"slate",label:"Slate"}]}async function me(e){try{let[t]=await f([`colors/${e}.json`]);return I.parse(t)}catch(t){d(t);}}async function de(e,t){let r=[];for(let n of t){let s=e.find(o=>o.name===n);if(s&&(r.push(s),s.registryDependencies)){let o=await de(e,s.registryDependencies);r.push(...o);}}return r.filter((n,s,o)=>o.findIndex(l=>l.name===n.name)===s)}async function sr(e,t){try{let r=t.map(s=>`styles/${e}/${s.name}.json`),n=await f(r);return E.parse(n)}catch(r){d(r);}}async function or(e,t,r){if(r)return r;if(t.type==="registry:ui")return e.resolvedPaths.ui??e.resolvedPaths.components;let[n,s]=t.type?.split(":")??[];return n in e.resolvedPaths?h.join(e.resolvedPaths[n],s):null}async function f(e){try{return await Promise.all(e.map(async r=>{let n=F(r),s=await ae(n,{agent:pe});if(!s.ok){let o={400:"Bad request",401:"Unauthorized",403:"Forbidden",404:"Not found",500:"Internal server error"};if(s.status===401)throw new Error(`You are not authorized to access the component at ${m.info(n)}.
If this is a remote registry, you may need to authenticate.`);if(s.status===404)throw new Error(`The component at ${m.info(n)} was not found.
It may not exist at the registry. Please make sure it is a valid component.`);if(s.status===403)throw new Error(`You do not have access to the component at ${m.info(n)}.
If this is a remote registry, you may need to authenticate or a token.`);let l=await s.json(),g=l&&typeof l=="object"&&"error"in l?l.error:s.statusText||o[s.status];throw new Error(`Failed to fetch from ${m.info(n)}.
${g}`)}return s.json()}))}catch(t){return p.error(`
`),d(t),[]}}async function ar(e,t){try{if(!await ge())return null;e.includes("index")&&e.unshift("index");let n=await ue(e,t),s=await f(n),o=z$1.array(y).parse(s);if(!o)return null;if(e.includes("index")&&t.tailwind.baseColor){let c=await ye(t.tailwind.baseColor,t);c&&o.unshift(c);}let l={};o.forEach(c=>{l=x(l,c.tailwind??{});});let g={};o.forEach(c=>{g=x(g,c.cssVars??{});});let u="";return o.forEach(c=>{c.docs&&(u+=`${c.docs}
`);}),A.parse({dependencies:x.all(o.map(c=>c.dependencies??[])),devDependencies:x.all(o.map(c=>c.devDependencies??[])),files:x.all(o.map(c=>c.files??[])),tailwind:l,cssVars:g,docs:u})}catch(r){return d(r),null}}async function fe(e,t){let r=new Set,n=[];async function s(o){let l=F(j(o)?o:`styles/${t.style}/${o}.json`);if(!r.has(l)){r.add(l);try{let[g]=await f([l]),u=y.parse(g);if(n.push(l),u.registryDependencies)for(let c of u.registryDependencies)await s(c);}catch(g){console.error(`Error fetching or parsing registry item at ${o}:`,g);}}}return await s(e),Array.from(new Set(n))}async function ye(e,t){let r=await me(e);if(!r)return null;let n={name:e,type:"registry:theme",tailwind:{config:{theme:{extend:{borderRadius:{lg:"var(--radius)",md:"calc(var(--radius) - 2px)",sm:"calc(var(--radius) - 4px)"},colors:{}}}}},cssVars:{light:{radius:"0.5rem"},dark:{}}};return t.tailwind.cssVariables&&(n.tailwind.config.theme.extend.colors={...n.tailwind.config.theme.extend.colors,...V(r.cssVars.dark)},n.cssVars={light:{...r.cssVars.light,...n.cssVars.light},dark:{...r.cssVars.dark,...n.cssVars.dark}}),n}function F(e){if(j(e)){let t=new URL(e);return t.pathname.match(/\/chat\/b\//)&&!t.pathname.endsWith("/json")&&(t.pathname=`${t.pathname}/json`),t.toString()}return `${ce}/${e}`}function j(e){try{return new URL(e),!0}catch{return !1}}async function ue(e,t){let r=[];for(let n of e){let s=await fe(n,t);r.push(...s);}return Array.from(new Set(r))}function lr(){return new Map([["registry:ui","ui"],["registry:lib","lib"],["registry:hook","hooks"],["registry:block","components"],["registry:component","components"]])}function cr(e){let t=new Map;return e.forEach(r=>{r.registryDependencies&&r.registryDependencies.forEach(n=>{t.set(n,r);});}),t}

export { or as A, f as B, ar as C, ye as D, ue as E, lr as F, cr as G, m as a, p as b, $ as c, d, Ne as e, z as f, ne as g, P as h, D as i, U as j, M as k, y as l, xe as m, E as n, v as o, K as p, I as q, A as r, ge as s, rr as t, tr as u, nr as v, ir as w, me as x, de as y, sr as z };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=chunk-P7W77U7C.js.map